full contents of src/lib/behaviourService.ts