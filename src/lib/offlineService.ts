full contents of src/lib/offlineService.ts