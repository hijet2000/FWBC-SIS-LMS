full contents of src/lib/ptmService.ts